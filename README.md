# GitHub Copilot SDK for Swift

> **Audit Status (2026-02-01):** ✅ This implementation has been audited against the [official copilot-sdk](https://github.com/github/copilot-sdk/) and is **FEATURE-COMPLETE** with protocol version 2. See [AUDIT.md](./AUDIT.md) for full details.

> NOTE! This was originally generated by Copilot by looking at [this commit](https://github.com/github/copilot-sdk/tree/a552ae497313143e2426d6ff7e99b2632ab573dd) of the `github/copilot-sdk`. YMMV with this package!

The Swift SDK for the GitHub Copilot CLI, enabling you to embed Copilot's agentic workflows in your iOS and macOS applications.

## Requirements

- iOS 15.0+ / macOS 12.0+ / tvOS 15.0+ / watchOS 8.0+
- Swift 5.9+
- Xcode 15.0+
- [Copilot CLI](https://docs.github.com/en/copilot/how-tos/set-up/install-copilot-cli) installed and available in PATH

## Installation

### Swift Package Manager

Add the following to your `Package.swift`:

```swift
dependencies: [
    .package(url: "https://github.com/joshspicer/copilot-sdk-swift/", from: "1.0.0")
]
```

Then add `GitHubCopilotSDK` to your target dependencies:

```swift
.target(
    name: "YourApp",
    dependencies: ["GitHubCopilotSDK"]
)
```

Or in Xcode: File → Add Package Dependencies → Enter `https://github.com/joshspicer/copilot-sdk-swift/`

## Quick Start

```swift
import GitHubCopilotSDK

// Create a client
let client = CopilotClient()

// Create a session
let session = try await client.createSession()

// Send a message
try await session.send("What is the capital of France?")

// Get the response
let response = try await session.getFinalMessage()
print(response) // "The capital of France is Paris."

// Clean up
await client.stop()
```

## API Reference

### CopilotClient

The main entry point for interacting with Copilot.

```swift
// Create with default options
let client = CopilotClient()

// Create with custom options
let client = CopilotClient(options: CopilotClientOptions(
    cliPath: "/usr/local/bin/copilot",
    logLevel: "debug",
    githubToken: "your-token"
))

// Connection management
try await client.connect()
await client.stop()

// API methods
let status = try await client.getStatus()
let authStatus = try await client.getAuthStatus()
let models = try await client.getModels()

// Session management
let session = try await client.createSession()
let sessions = try await client.listSessions()
try await client.deleteSession(sessionId: "...")
```

### CopilotSession

Represents an active conversation with Copilot.

```swift
// Send messages
let messageId = try await session.send("Hello!")
let messageId = try await session.send(MessageOptions(
    prompt: "Analyze this file",
    attachments: [.file("/path/to/file.swift")]
))

// Get messages/events
let events = try await session.getMessages()

// Wait for response
let response = try await session.getFinalMessage(timeout: 60)

// Event streaming
for await event in session.events {
    switch event.type {
    case .assistantMessage:
        if case .assistantMessage(let data) = event.data {
            print(data.content ?? "")
        }
    case .sessionIdle:
        break
    default:
        break
    }
}

// Control
try await session.abort()
try await session.destroy()
```

### Tools

Define custom tools that Copilot can invoke:

```swift
let calculatorTool = Tool(
    name: "calculate",
    description: "Perform a calculation",
    parameters: JSONSchema.object(
        properties: [
            "expression": JSONSchema.string(description: "Math expression to evaluate")
        ],
        required: ["expression"]
    )
) { invocation in
    let expression = invocation.getString("expression") ?? ""
    // Evaluate the expression...
    return .success("Result: 42")
}

let session = try await client.createSession(SessionConfig(
    tools: [calculatorTool]
))
```

### Hooks

React to session lifecycle events:

```swift
let session = try await client.createSession(SessionConfig(
    hooks: SessionHooks(
        onPreToolUse: { input, invocation in
            print("About to use tool: \(input.toolName)")
            return PreToolUseHookOutput(permissionDecision: "allow")
        },
        onPostToolUse: { input, invocation in
            print("Tool \(input.toolName) completed")
            return nil
        },
        onSessionStart: { input, invocation in
            print("Session started: \(input.source)")
            return nil
        }
    )
))
```

### Permissions

Handle permission requests:

```swift
let session = try await client.createSession(SessionConfig(
    onPermissionRequest: { request, invocation in
        switch request.kind {
        case "file":
            return PermissionRequestResult(kind: "allow")
        case "shell":
            return PermissionRequestResult(kind: "deny")
        default:
            return PermissionRequestResult(kind: "ask")
        }
    }
))
```

### User Input

Enable the ask_user tool for interactive prompts:

```swift
let session = try await client.createSession(SessionConfig(
    onUserInputRequest: { request, invocation in
        // Show UI to get user input
        let answer = await showUserPrompt(request.question, choices: request.choices)
        return UserInputResponse(answer: answer, wasFreeform: true)
    }
))
```

### BYOK (Bring Your Own Key)

Use your own API keys:

```swift
let session = try await client.createSession(SessionConfig(
    model: "gpt-4",
    provider: ProviderConfig(
        baseUrl: "https://api.openai.com/v1",
        apiKey: "your-api-key"
    )
))
```

### MCP Servers

Configure MCP (Model Context Protocol) servers:

```swift
let session = try await client.createSession(SessionConfig(
    mcpServers: [
        "filesystem": AnyCodable([
            "type": "local",
            "command": "npx",
            "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path"],
            "tools": ["*"]
        ])
    ]
))
```

## Streaming

Enable streaming for real-time responses:

```swift
let session = try await client.createSession(SessionConfig(
    streaming: true
))

try await session.send("Write a story")

for await event in session.events {
    if event.type == .assistantMessageDelta,
       case .assistantMessageDelta(let data) = event.data {
        print(data.deltaContent ?? "", terminator: "")
    }
}
```

## Error Handling

```swift
do {
    let session = try await client.createSession()
    try await session.send("Hello")
} catch CopilotError.connectionFailed(let underlying) {
    print("Connection failed: \(underlying?.localizedDescription ?? "unknown")")
} catch CopilotError.protocolVersionMismatch(let expected, let actual) {
    print("Version mismatch: expected \(expected), got \(actual)")
} catch CopilotError.timeout {
    print("Operation timed out")
} catch {
    print("Error: \(error)")
}
```

## Platform Considerations

### iOS

The SDK uses `Process` to communicate with the Copilot CLI, which requires certain entitlements for iOS apps. For sandboxed iOS apps, you may need to:

1. Connect to a remote Copilot CLI server running on a Mac
2. Use the `cliUrl` option to specify the server address

```swift
let client = CopilotClient(options: CopilotClientOptions(
    cliUrl: "http://192.168.1.100:8080"
))
```

### macOS

On macOS, the SDK can directly spawn the Copilot CLI process. Ensure the CLI is installed and accessible:

```bash
# Install Copilot CLI
brew install gh
gh extension install github/gh-copilot

# Or use the standalone installer
# See: https://docs.github.com/en/copilot/how-tos/set-up/install-copilot-cli
```

## Examples

See the [cookbook](../cookbook/swift/README.md) for more examples:

- [Error Handling](../cookbook/swift/error-handling.md)
- [Multiple Sessions](../cookbook/swift/multiple-sessions.md)
- [Managing Local Files](../cookbook/swift/managing-local-files.md)
- [PR Visualization](../cookbook/swift/pr-visualization.md)
- [Persisting Sessions](../cookbook/swift/persisting-sessions.md)

## License

MIT
